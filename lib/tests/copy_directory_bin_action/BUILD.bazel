load("//lib:diff_test.bzl", "diff_test")
load(":pkg.bzl", "pkg")

NOT_WINDOWS = select({
    "@platforms//os:windows": ["@platforms//:incompatible"],
    "//conditions:default": [],
})

pkg(
    name = "pkg",
    src = "d",
    out = "d2",
    # TODO: re-enable this test on windows
    target_compatible_with = NOT_WINDOWS,
)

pkg(
    name = "pkg2",
    src = "pkg",
    out = "d3",
    # TODO: re-enable this test on windows
    target_compatible_with = NOT_WINDOWS,
)

diff_test(
    name = "copy_test",
    file1 = ":d",
    file2 = ":pkg",
    # TODO: re-enable this test on windows
    target_compatible_with = NOT_WINDOWS,
)

diff_test(
    name = "hardlink_test",
    file1 = ":d",
    file2 = ":pkg2",
    # TODO: re-enable this test on windows
    target_compatible_with = NOT_WINDOWS,
)

diff_test(
    name = "sanity_test",
    file1 = ":pkg",
    file2 = ":pkg2",
    # TODO: re-enable this test on windows
    target_compatible_with = NOT_WINDOWS,
)
